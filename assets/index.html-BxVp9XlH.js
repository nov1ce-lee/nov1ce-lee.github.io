import{_ as s,c as e,e as a,o as l}from"./app-B6rSt3_j.js";const t={};function n(h,i){return l(),e("div",null,i[0]||(i[0]=[a(`<h3 id="启动-llama-factory-的可视化微调界面" tabindex="-1"><a class="header-anchor" href="#启动-llama-factory-的可视化微调界面"><span>启动 LLama-Factory 的可视化微调界面</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">llamafactory-cli</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> webui</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="从-huggingface-上下载基座模型" tabindex="-1"><a class="header-anchor" href="#从-huggingface-上下载基座模型"><span>从 HuggingFace 上下载基座模型</span></a></h3><ul><li>创建文件夹统一存放所有基座模型</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">mkdir</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> hugging-Face</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>修改 HuggingFace 的镜像源</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">export</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> HF_ENDPOINT</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">https</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">://</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">hf-mirror</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">com</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>修改模型下载的默认位置</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">export</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> HF_HOME</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">/</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">home</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">/</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">jingzhao</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">/</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">fine-tuning</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">/</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">hugging-face</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="hint-container note"><p class="hint-container-title">注</p><p>注意：这种配置方式只在当前 <code>shell</code> 会话中有效，如果你希望这个环境变量在每次启动终端时都生效，可以将其添加到你的用户配置文件中（修改 ~/.bashrc 或 ~/.zshrc）</p></div><ul><li>检查环境变量是否生效</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">echo</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> $HF_ENDPOINT</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">echo</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> $HF_HOME</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>安装 HuggingFace 官方下载工具</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">pip</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -U</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> huggingface_hub</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>执行下载命令（可以在<a href="https://hf-mirror.com/" target="_blank" rel="noopener noreferrer">HF镜像站</a>和<a href="https://huggingface.co/models" target="_blank" rel="noopener noreferrer">Hugging Face官网</a>找到模型名称）</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">huggingface-cli</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> download</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --resume-download</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> model-name</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="在可视化页面加载模型" tabindex="-1"><a class="header-anchor" href="#在可视化页面加载模型"><span>在可视化页面加载模型</span></a></h3><ul><li>模型路径为模型特定快照的唯一哈希值，打开下载路径即可看到，复制文件路径即可</li></ul><h3 id="准备数据集" tabindex="-1"><a class="header-anchor" href="#准备数据集"><span>准备数据集</span></a></h3><ul><li>修改 dataset_info.json 文件，添加如下配置：</li></ul><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-json"><span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">your_dataset</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">: </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">    &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">file_name</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">your_dataset.json</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">,</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>将数据集 <code>your_dataset.json</code> 放到 <code>LLama-Factory</code> 的 <code>data</code> 目录下</li></ul><h3 id="启动训练" tabindex="-1"><a class="header-anchor" href="#启动训练"><span>启动训练</span></a></h3><ul><li>页面上点击<code>启动训练</code>，或复制命令到终端启动训练<br> 实践中推荐用 <code>nohup</code> 命令将训练任务放到后台执行，这样即使关闭终端任务也会继续运行。同时将日志重定向到文件中保存下来</li><li>在训练过程中注意观察<code>损失曲线</code>，尽可能将损失降到最低<br> 如损失降低太慢，尝试增大<code>学习率</code><br> 如训练结束损失还呈下降趋势，增大<code>训练轮数</code>确保拟合</li></ul><h3 id="微调结束-评估微调效果" tabindex="-1"><a class="header-anchor" href="#微调结束-评估微调效果"><span>微调结束，评估微调效果</span></a></h3><ul><li>观察损失曲线的变化；观察最终损失</li><li>在交互页面上通过预测/对话等方式测试微调好的效果</li><li>检查点：保存的是模型在训练过程中的一个中间状态，包含了模型权重、训练过程中使用的配置（如学习率、批次大小）等信息，对LoRA来说，检查点包含了训练得到的 B 和 A 这两个低秩矩阵的权重</li></ul><p>若微调效果不理想，你可以：</p><ul><li>使用更强的预训练模型</li><li>增加数据量</li><li>优化数据质量（数据清洗、数据增强等，可学习相关论文如何实现）</li><li>调整训练参数，如学习率、训练轮数、优化器、批次大小等等</li></ul><h3 id="导出合并后的模型" tabindex="-1"><a class="header-anchor" href="#导出合并后的模型"><span>导出合并后的模型</span></a></h3><blockquote><p>为什么要合并：因为 LoRA 只是通过低秩矩阵调整原始模型的部分权重，而不直接修改原模型的权重。合并步骤将 LoRA 权重与原始模型权重融合生成一个完整的模型</p></blockquote><p>先创建目录，用于存放导出后的模型</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">mkdir</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -p</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> models/merged</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>在页面上配置导出路径，导出即可</p>`,33)]))}const r=s(t,[["render",n]]),k=JSON.parse('{"path":"/notes/aillm/fine-tuning/process/","title":"模型微调常用步骤","lang":"zh-CN","frontmatter":{"title":"模型微调常用步骤","createTime":"2025/03/31 17:03:40","permalink":"/notes/aillm/fine-tuning/process/","description":"启动 LLama-Factory 的可视化微调界面 从 HuggingFace 上下载基座模型 创建文件夹统一存放所有基座模型 修改 HuggingFace 的镜像源 修改模型下载的默认位置 注 注意：这种配置方式只在当前 shell 会话中有效，如果你希望这个环境变量在每次启动终端时都生效，可以将其添加到你的用户配置文件中（修改 ~/.bashrc ...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"模型微调常用步骤\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-12-11T16:51:13.000Z\\",\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://nov1ce-lee.github.io/notes/aillm/fine-tuning/process/"}],["meta",{"property":"og:site_name","content":"novice.log"}],["meta",{"property":"og:title","content":"模型微调常用步骤"}],["meta",{"property":"og:description","content":"启动 LLama-Factory 的可视化微调界面 从 HuggingFace 上下载基座模型 创建文件夹统一存放所有基座模型 修改 HuggingFace 的镜像源 修改模型下载的默认位置 注 注意：这种配置方式只在当前 shell 会话中有效，如果你希望这个环境变量在每次启动终端时都生效，可以将其添加到你的用户配置文件中（修改 ~/.bashrc ..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-12-11T16:51:13.000Z"}],["meta",{"property":"article:modified_time","content":"2025-12-11T16:51:13.000Z"}]]},"readingTime":{"minutes":2.48,"words":745},"git":{"createdTime":1765471873000,"updatedTime":1765471873000,"contributors":[{"name":"nov1ce","username":"nov1ce","email":"289836737@qq.com","commits":1,"avatar":"https://avatars.githubusercontent.com/nov1ce?v=4","url":"https://github.com/nov1ce"}]},"autoDesc":true,"filePathRelative":"notes/aillm/微调训练/LLaMA Factory/3.微调步骤.md","headers":[]}');export{r as comp,k as data};
