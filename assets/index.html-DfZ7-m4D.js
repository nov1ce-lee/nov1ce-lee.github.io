import{_ as n,c as l,e as i,b as e,r as h,o as t}from"./app-Cq1n2Fq0.js";const p={};function k(d,s){const a=h("LinkCard");return t(),l("div",null,[s[0]||(s[0]=i(`<p>在上一章节中，我们已经对丝之歌mod开发的环境做了必要的准备</p><p>接下来我们以开发一个 <code>AlwaysCompass</code> Mod作为例子来引入，具体功能为不论是否装备<code>罗盘</code>，都可以在地图上显示大黄蜂的位置</p><hr><h2 id="步骤" tabindex="-1"><a class="header-anchor" href="#步骤"><span>步骤</span></a></h2><h3 id="_1-创建mod" tabindex="-1"><a class="header-anchor" href="#_1-创建mod"><span>1. 创建Mod</span></a></h3><ul><li><p>首先进入想要创建mod的空文件夹，在终端输入命令后使用模板创建mod</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-sh"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># name一般为GitHub用户名</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">dotnet</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> new</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> silksongplugin</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --username</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> name</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>创建完毕后，可以看到生成一系列文件和内容，首先需要重点关注<code>项目名+Plugin.cs</code>，这是Mod的入口文件，在这里可以进行Mod的初始化</p><div class="language-c# line-numbers-mode" data-highlighter="shiki" data-ext="c#" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-c#"><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">using</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;"> BepInEx</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">namespace</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;"> AlwaysCompass</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">// TODO - adjust the plugin guid as needed</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;">BepInAutoPlugin</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">id</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">io.github.nov1ce-lee.alwaysmagnetite</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)]</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">public</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> partial</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> class</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;"> AlwaysCompassPlugin</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> :</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;"> BaseUnityPlugin</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">    private</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> void</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> Awake</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    {</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">        // Put your initialization logic here</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">        Logger</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">LogInfo</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">$&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Plugin </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> (</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Id</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">) has loaded!</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    }</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>在该Mod入口文件中，主要包含几个主要部分：<br> ① 一个继承<code>BaseUnityPlugin</code>的类<br> ② <code>BepInAutoPlugin</code>属性及其他元数据<br> ③ 一个<code>Awake()</code>方法，这是Mod的初始化方法，在这里可以进行Mod的初始化</p><div class="hint-container tip"><p class="hint-container-title">提示</p><p><a href="https://docs.bepinex.dev/api/BepInEx.BaseUnityPlugin.html" target="_blank" rel="noopener noreferrer">BaseUnityPlugin</a> 继承了 <a href="https://docs.unity3d.com/ScriptReference/MonoBehaviour.html" target="_blank" rel="noopener noreferrer">UnityEngine.MonoBehaviour</a><br> 因此，你可以使用相同的事件方法，比如 <code>Awake</code>, <code>Update</code> 等</p></div></li><li><p>打开<code>SilksongPath.props</code>文件，并将内部<code>SilksongFolder</code>对应的地址更改为自己游戏的根目录 <img src="https://pic-1326566629.cos.ap-shanghai.myqcloud.com/blog/20260128190553642.png" alt="" loading="lazy"></p></li><li><p>执行命令尝试编译构建插件，构建成功后会生成mod文件，并自动复制到 <code>BepInEx/plugins</code> 目录下</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-sh"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">dotnet</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> build</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul><h3 id="_2-查看代码原有逻辑" tabindex="-1"><a class="header-anchor" href="#_2-查看代码原有逻辑"><span>2. 查看代码原有逻辑</span></a></h3><ul><li>在dnspy中搜索<code>CompassTool</code><img src="https://pic-1326566629.cos.ap-shanghai.myqcloud.com/blog/20260128192127036.png" alt="" loading="lazy"></li><li>分析字段的方法被调用的位置 <img src="https://pic-1326566629.cos.ap-shanghai.myqcloud.com/blog/20260128192302106.png" alt="" loading="lazy"></li><li>点击方法 <code>GameMap.PositionCompassAndCorpse()</code>查看 <img src="https://pic-1326566629.cos.ap-shanghai.myqcloud.com/blog/20260128192604586.png" alt="" loading="lazy"></li><li>可以看到map的相关方法会根据<code>compassTool.IsEquipped</code>判断是否装备罗盘，因此我们可以通过对这个方法进行拦截，来强制返回已装备罗盘的结果</li></ul><h3 id="_3-加入补丁" tabindex="-1"><a class="header-anchor" href="#_3-加入补丁"><span>3. 加入补丁</span></a></h3><div class="hint-container tip"><p class="hint-container-title">提示</p><p>运行时补丁是指修改方法而不进行永久补丁的过程，详情可看<a href="https://docs.bepinex.dev/articles/dev_guide/runtime_patching.html" target="_blank" rel="noopener noreferrer">运行时的补丁方法</a></p><p><code>BepInEx</code>自带<code>HarmonyX</code>用于执行运行时补丁，补丁的作用是不修改原有游戏代码的前提下修改方法，使其返回固定值或者执行自定义逻辑</p><p>具体作用就是，当游戏运行时调用这个方法时，会先执行补丁方法，如果返回了false，则不会执行原方法，反之则执行原方法</p></div><ul><li><p>根据我们前面看的罗盘工具的判断逻辑，编写补丁代码，整体逻辑为：</p><div class="language-c# line-numbers-mode" data-highlighter="shiki" data-ext="c#" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-c#"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">// Patch : 拦截 ToolItem.IsEquipped</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;">HarmonyPatch</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">typeof</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;">ToolItem</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">),</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">IsEquipped</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> MethodType</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">Getter</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)]</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">public</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> static</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> class</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;"> ToolItemIsEquippedPatch</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">    public</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> static</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> bool</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> Prefix</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;">ToolItem</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> __instance</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> ref</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> bool</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> __result</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">        // 如果是罗盘</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">        if</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> (</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">__instance</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> ==</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> Gameplay</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">CompassTool</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">        {</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">            __result</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> true</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  // 强制返回&quot;已装备&quot;</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">            return</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> false</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">     // 跳过原方法</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">        }</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">        </span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">        return</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> true</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  // 不是罗盘，执行原方法</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    }</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>对于罗盘的内容，其实是不需要下面的补丁的，但在代码中对于很多工具对象的状态对象，都会调用这个方法进行判断，所以会需要补丁</p><div class="language-c# line-numbers-mode" data-highlighter="shiki" data-ext="c#" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-c#"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  // Patch : 拦截 ToolStatus.IsEquipped</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  [</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;">HarmonyPatch</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">typeof</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;">ToolItemManager</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;">ToolStatus</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">),</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">IsEquipped</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> MethodType</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">Getter</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)]</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">  public</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> static</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> class</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;"> ToolStatusIsEquippedPatch</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  {</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">      public</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> static</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> bool</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> Prefix</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;">ToolItemManager</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;">ToolStatus</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> __instance</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> ref</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> bool</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> __result</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">      {</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">          // 如果这个状态对象管理的是罗盘</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">          if</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> (</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">__instance</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">tool</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> ==</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> Gameplay</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">CompassTool</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">          {</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">              __result</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> true</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">              return</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> false</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">          }</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">          </span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">          return</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> true</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">      }</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>代码编写完成后，再次编译，此时我们已经拥有了一个可以实现永久罗盘功能的Mod了</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-sh"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">dotnet</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> build</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul><h2 id="配置相关" tabindex="-1"><a class="header-anchor" href="#配置相关"><span>配置相关</span></a></h2><h3 id="添加配置项" tabindex="-1"><a class="header-anchor" href="#添加配置项"><span>添加配置项</span></a></h3><p>那么我们该如何实现mod的开关呢，这就要在代码中添加一个配置项，更多可见<a href="https://docs.bepinex.dev/master/articles/dev_guide/plugin_tutorial/4_configuration.html" target="_blank" rel="noopener noreferrer">BepInEx配置管理</a></p><ul><li>在插件内部，你可以访问到 <code>@BepInEx.BaseUnityPlugin.Config</code> 属性，这是一个预配置的配置文件</li><li>文件保存在 <code>BepInEx\\config\\&lt;GUID&gt;.cfg</code>，其中 <code>&lt;GUID&gt;</code> 就是插件的 GUID</li><li>要访问和创建配置值，首先需要用 <code>Bind&lt;T&gt;(String， String， T， String)</code> 来定义它们，配置初始化通常在插件启动代码中完成</li></ul><p>那么修改前面的插件代码如下：</p><div class="language-c# line-numbers-mode" data-highlighter="shiki" data-ext="c#" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-c#"><span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">private</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;"> BepInEx</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;">Configuration</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;">ConfigEntry</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&lt;</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">bool</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&gt;</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> IsEnabled</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">private</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> void</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> Awake</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    Instance</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> this</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    IsEnabled</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> Config</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">Bind</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">General</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">      // 配置分组</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">                            &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Enabled</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">      // 配置项名称</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">                            true</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">           // 默认值</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">                            &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Enable or disable the Always Compass mod</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    // 配置项描述</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    Logger</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">LogInfo</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">$&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Plugin </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> (</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Id</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">) has loaded!</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">    new</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;"> Harmony</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">Id</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">).</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">PatchAll</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">();</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当你编译插件并首次运行游戏时，配置文件就会自动生成</p><h3 id="配置管理" tabindex="-1"><a class="header-anchor" href="#配置管理"><span>配置管理</span></a></h3><ol><li>使用 <code>BepInExConfigManager</code>工具来管理mod，这是最通用且方便的方法</li></ol>`,20)),e(a,{title:"BepInExConfigManager",icon:"mdi:github",href:"https://github.com/sinai-dev/BepInExConfigManager"}),s[1]||(s[1]=i('<ul><li>需要安装 BepInEx Configuration Manager 插件</li><li>操作方法 ： <ol><li>进入游戏</li><li>按下 F5 键</li><li>在弹出的菜单中找到 AlwaysCompass</li><li>展开 General 选项卡，您会看到 Enabled 勾选框</li><li>勾选或取消勾选即可实时开启/关闭 Mod 功能（代码中是实时检查 IsEnabled.Value 的）</li></ol></li></ul><ol start="2"><li>修改配置文件（无 UI） 如果没有安装 Configuration Manager，可以通过修改文件来配置：</li></ol><ul><li>位置 ： SilksongPath/BepInEx/config/io.github.nov1ce-lee.alwayscompass.cfg</li><li>操作 ：用记事本打开该文件，修改 Enabled = true 或 false</li></ul>',3))])}const g=n(p,[["render",k]]),o=JSON.parse('{"path":"/notes/games/silk_song/modding/first_mod/","title":"开发第一个Mod","lang":"zh-CN","frontmatter":{"title":"开发第一个Mod","createTime":"2026/01/28 01:54:27","permalink":"/notes/games/silk_song/modding/first_mod/","description":"在上一章节中，我们已经对丝之歌mod开发的环境做了必要的准备 接下来我们以开发一个 AlwaysCompass Mod作为例子来引入，具体功能为不论是否装备罗盘，都可以在地图上显示大黄蜂的位置 步骤 1. 创建Mod 首先进入想要创建mod的空文件夹，在终端输入命令后使用模板创建mod 创建完毕后，可以看到生成一系列文件和内容，首先需要重点关注项目名+...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"开发第一个Mod\\",\\"image\\":[\\"https://pic-1326566629.cos.ap-shanghai.myqcloud.com/blog/20260128190553642.png\\",\\"https://pic-1326566629.cos.ap-shanghai.myqcloud.com/blog/20260128192127036.png\\",\\"https://pic-1326566629.cos.ap-shanghai.myqcloud.com/blog/20260128192302106.png\\",\\"https://pic-1326566629.cos.ap-shanghai.myqcloud.com/blog/20260128192604586.png\\"],\\"dateModified\\":\\"2026-01-28T17:46:26.000Z\\",\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://nov1ce-lee.github.io/notes/games/silk_song/modding/first_mod/"}],["meta",{"property":"og:site_name","content":"novice.log"}],["meta",{"property":"og:title","content":"开发第一个Mod"}],["meta",{"property":"og:description","content":"在上一章节中，我们已经对丝之歌mod开发的环境做了必要的准备 接下来我们以开发一个 AlwaysCompass Mod作为例子来引入，具体功能为不论是否装备罗盘，都可以在地图上显示大黄蜂的位置 步骤 1. 创建Mod 首先进入想要创建mod的空文件夹，在终端输入命令后使用模板创建mod 创建完毕后，可以看到生成一系列文件和内容，首先需要重点关注项目名+..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://pic-1326566629.cos.ap-shanghai.myqcloud.com/blog/20260128190553642.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2026-01-28T17:46:26.000Z"}],["meta",{"property":"article:modified_time","content":"2026-01-28T17:46:26.000Z"}]]},"readingTime":{"minutes":4.14,"words":1243},"git":{"createdTime":1769537853000,"updatedTime":1769622386000,"contributors":[{"name":"nov1ce","username":"nov1ce","email":"289836737@qq.com","commits":2,"avatar":"https://avatars.githubusercontent.com/nov1ce?v=4","url":"https://github.com/nov1ce"},{"name":"novice","username":"novice","email":"289836737@qq.com","commits":2,"avatar":"https://avatars.githubusercontent.com/novice?v=4","url":"https://github.com/novice"}]},"autoDesc":true,"filePathRelative":"notes/game/空洞骑士系列/2.丝之歌/2.模组制作/2.开发第一个Mod.md","headers":[]}');export{g as comp,o as data};
