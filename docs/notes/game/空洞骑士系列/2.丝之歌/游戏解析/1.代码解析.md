---
title: 代码解析
createTime: 2026/01/12 23:28:06
permalink: /notes/games/hollow_knight/silk_song/code-parse/
---

> 免责声明：本教程仅用于学习丝之歌游戏的代码，为熟悉存档结构、开发丝之歌mod做准备，请勿用于商业用途

本文将主要介绍如何解析游戏的代码

---

### 需要用到的工具
#### dnspy     
这是一个调试器和`.NET`汇编编辑器，即使没有源代码，也可以用它来编辑和调试`.NET`和`Unity`汇编     
如何下载：访问[dnspy的GitHub仓库](https://github.com/dnSpy/dnSpy)，下载对应系统的release版本(已经归档很久了，但是仍然可以使用)

---

### 解析游戏代码
#### 解析步骤
1. 解压下载的`dnspy`压缩包，启动`dnspy.exe`程序

2. 使用Steam浏览本地文件的功能，打开游戏安装目录`Steam\steamapps\common\Hollow Knight Silksong`，并进入`\Hollow Knight Silksong_Data\Managed`文件夹，找到`Assembly-CSharp.dll`文件

3. 在`dnspy`中打开`Assembly-CSharp.dll`文件
![](https://pic-1326566629.cos.ap-shanghai.myqcloud.com/notes/20260113002009569.png)
![](https://pic-1326566629.cos.ap-shanghai.myqcloud.com/notes/20260113002232786.png)

4. 可以点击 `{}-` 查看主要的内容，此时已经可以随意浏览代码了
![](https://pic-1326566629.cos.ap-shanghai.myqcloud.com/notes/20260113002921912.png)

5. 快捷键`Ctrl+Shift+K`，打开搜索框，如搜索`playerdata`，可以找到`PlayerData`类，这个类存储了玩家存档数据的字段，也包含了很多对应的方法
![](https://pic-1326566629.cos.ap-shanghai.myqcloud.com/notes/20260113002612634.png)

6. 快捷键`Ctrl+Shift+R`，对变量或方法进行分析，可以获取其上游调用者和下游被调用者的信息，如获取`PlayerData`类中`maxHealthBase`字段的上下游
![](https://pic-1326566629.cos.ap-shanghai.myqcloud.com/notes/20260113003736295.png)

#### 具体示例
我们借助上面的示例，分析一下`maxHealthBase`字段
```c#
/* 获取最大生命值字段 */
[DefaultValue(5)]
public int maxHealthBase;
```
可以看到其下有个调用方法`PlayerData.CountGameCompletion()`，这个方法会用于统计玩家存档的完成度  
我们可以双击方法直接跳转至具体调用位置，查看是如何根据`maxHealthBase`字段来计算完成度的
```c#
this.completionPercentage += (float)(this.maxHealthBase - 5);
```
可以看到，这个字段的完成度是`maxHealthBase - 5`，因此可以通过`playerData.maxHealthBase - 5`的值来获取面具完成度   
每一个完整收集的面具会增加一个血量上限，也就是`maxHealthBase`字段的值会增加 1

从这里出发，我们可以继续寻找其他字段的具体分析，也可以根据`PlayerData.CountGameCompletion()`方法来分析其他字段的完成度是如何统计的
