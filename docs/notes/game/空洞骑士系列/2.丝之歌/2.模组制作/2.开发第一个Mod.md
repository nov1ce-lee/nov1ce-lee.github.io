---
title: 开发第一个Mod
createTime: 2026/01/28 01:54:27
permalink: /notes/games/silk_song/modding/first_mod/
---

在上一章节中，我们已经对丝之歌mod开发的环境做了必要的准备

接下来我们以开发一个 `AlwaysMagnetite` Mod作为例子来引入，具体功能为不论是否装备`磁石胸针`，都可以有用自动吸引掉落念珠的能力

### 步骤
- 创建Mod
首先进入想要创建mod的空文件夹，在终端输入命令后使用模板创建mod
  ```sh
  # name一般为GitHub用户名
  dotnet new silksongplugin --username name   
  ```

- 创建完毕后，可以看到一系列文件和内容，首先需要重点关注`项目名+Plugin.cs`，这是Mod的入口文件，在这里可以进行Mod的初始化
  ```c#
  using BepInEx;

  namespace AlwaysMagnetite;

  // TODO - adjust the plugin guid as needed
  [BepInAutoPlugin(id: "io.github.nov1ce-lee.alwaysmagnetite")]
  public partial class AlwaysMagnetitePlugin : BaseUnityPlugin
  {
      private void Awake()
      {
          // Put your initialization logic here
          Logger.LogInfo($"Plugin {Name} ({Id}) has loaded!");
      }
  }

  ```

- 加入补丁
  ```c#
  // Patch 1: 拦截 ToolItem.IsEquipped
  [HarmonyPatch(typeof(ToolItem), "IsEquipped", MethodType.Getter)]
  public static class ToolItemIsEquippedPatch
  {
      public static bool Prefix(ToolItem __instance, ref bool __result)
      {

          // 如果是罗盘
          if (__instance == Gameplay.CompassTool)
          {
              __result = true;  // 强制返回"已装备"
              return false;     // 跳过原方法
          }
          
          return true;  // 不是罗盘，执行原方法
      }
  }

  // Patch 2: 拦截 ToolStatus.IsEquipped
  [HarmonyPatch(typeof(ToolItemManager.ToolStatus), "IsEquipped", MethodType.Getter)]
  public static class ToolStatusIsEquippedPatch
  {
      public static bool Prefix(ToolItemManager.ToolStatus __instance, ref bool __result)
      {
          // 如果这个状态对象管理的是罗盘
          if (__instance.tool == Gameplay.CompassTool)
          {
              __result = true;
              return false;
          }
          
          return true;
      }
  }
  ```

- 配置

- 构建
---

### 配置相关
https://github.com/sinai-dev/BepInExConfigManager

如何使用配置文件
https://docs.bepinex.dev/master/articles/dev_guide/plugin_tutorial/4_configuration.html

要在 游戏内 配置这个 Mod，通常有以下两种方式：

1. 使用 BepInEx Configuration Manager（推荐）
这是最通用且方便的方法。

- 前提 ：您（或使用 Mod 的玩家）需要安装 BepInEx Configuration Manager 插件
- 操作方法 ：
  1. 进入游戏
  2. 按下 F5 键
  3. 在弹出的菜单中找到 AlwaysCompass
  4. 展开 General 选项卡，您会看到 Enabled 勾选框
  5. 勾选或取消勾选即可实时开启/关闭 Mod 功能（代码中是实时检查 IsEnabled.Value 的）
2. 修改配置文件（无 UI）
如果没有安装 Configuration Manager，可以通过修改文件来配置：

- 位置 ： SilksongPath/BepInEx/config/io.github.nov1ce-lee.alwayscompass.cfg
- 操作 ：用记事本打开该文件，修改 Enabled = true 或 false 


